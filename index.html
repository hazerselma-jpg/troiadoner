<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Troia D√∂ner | Online Sipari≈ü</title>
  <style>
    :root{
      --bg-1:#0c0a10; --bg-2:#171320;
      --accent:#f6d365; --accent-2:#fda085;
      --card: rgba(24,20,32,0.78);
      --muted:#bfbfc3;
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif}
    body{
      background: radial-gradient(120% 140% at 20% 20%, rgba(253,160,133,0.12), transparent 40%),
                  radial-gradient(120% 120% at 80% 0%, rgba(246,211,101,0.12), transparent 38%),
                  linear-gradient(145deg,var(--bg-1),var(--bg-2));
      color:#f5f5f5;
      min-height:100vh;padding:16px;
    }
    a{color:inherit;text-decoration:none}

    .page{max-width:980px;margin:0 auto;padding:22px;border-radius:18px;border:1px solid rgba(255,255,255,0.03);background:linear-gradient(120deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}

    header{padding:20px 0 14px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.04)}
    header h1{font-size:2.1rem;letter-spacing:.08em;text-transform:uppercase}
    header h1 span{color:#f5c451}
    header p{margin-top:6px;color:var(--muted);font-size:.95rem}

    .hero{display:flex;flex-wrap:wrap;align-items:center;gap:18px;padding:22px 0;position:relative}
    .hero-text{flex:1 1 300px}
    .hero-text h2{font-size:1.6rem;margin-bottom:8px}
    .hero-text p{color:#dcdcdc;margin-bottom:12px;line-height:1.4}
    .hero-tags{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px}
    .tag{background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.03);font-size:.82rem;color:var(--muted)}

    .btn-main{display:inline-block;padding:12px 20px;border-radius:999px;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#111;font-weight:800;box-shadow:0 12px 30px rgba(253,160,133,0.12)}
    .btn-main small{display:block;font-size:.78rem;opacity:.85;margin-top:4px}

    /* menu */
    .menu{margin-top:18px;padding-top:18px;border-top:1px solid rgba(255,255,255,0.03)}
    .menu h2{margin-bottom:14px;font-size:1.25rem}
    .menu-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:14px}

    .item{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 10px 28px rgba(0,0,0,0.35);position:relative;display:flex;flex-direction:column;gap:8px}
    .item-header{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .item-name{font-weight:700;font-size:1rem}
    .item-price{color:#f5c451;font-weight:800}
    .item-desc{color:#d7d7d7;font-size:.92rem;line-height:1.45;margin-top:4px}
    .item-note{color:#bdbdbf;font-size:.82rem;margin-top:6px}

    /* improved spacing/premium look for option area */
    .item-actions{display:flex;gap:8px;align-items:center;margin-top:8px}
    .qty-input{width:86px;padding:8px;border-radius:8px;background:rgba(0,0,0,0.45);border:1px solid rgba(255,255,255,0.04);color:#fff;font-weight:600}
    .btn-action{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.01);color:#fff;cursor:pointer;font-weight:700}
    .btn-toggle-opts{padding:8px 10px;border-radius:10px;background:transparent;border:1px dashed rgba(255,255,255,0.04);color:var(--muted);cursor:pointer}

    .item-opts{margin-top:10px;border-top:1px solid rgba(255,255,255,0.03);padding-top:10px;display:none;gap:10px}
    .option-group{display:flex;flex-direction:column;gap:8px;margin-bottom:6px}
    .option-group h4{font-size:.95rem;color:#f5c451;margin-bottom:6px}
    .options-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px}
    .option-choice{display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);cursor:pointer}
    .option-choice input{transform:scale(1.05)}
    .option-label{font-size:.92rem;color:#e9e9e9}

    /* cart */
    .cart-toggle{position:fixed;right:18px;bottom:18px;z-index:9998}
    .cart-toggle button{background:linear-gradient(0deg,#111,#1b1b1b);color:#fff;border-radius:12px;padding:12px 16px;border:1px solid rgba(255,255,255,0.04);font-weight:800;box-shadow:0 8px 30px rgba(0,0,0,0.45)}
    .cart-panel{position:fixed;right:18px;bottom:72px;width:min(460px,96%);max-height:80vh;overflow:auto;z-index:9999;background:linear-gradient(180deg, rgba(10,10,12,0.98), rgba(16,16,20,0.98));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.04);display:none}
    .cart-item{display:flex;gap:10px;align-items:flex-start;padding:10px;border-bottom:1px solid rgba(255,255,255,0.03)}
    .cart-item-name{font-weight:800}
    .cart-controls{margin-left:auto;display:flex;gap:8px;align-items:center}
    .cart-controls button{background:transparent;border-radius:8px;padding:6px 8px;border:1px solid rgba(255,255,255,0.04);color:#fff;cursor:pointer}
    .cart-total{margin-top:12px;display:flex;justify-content:space-between;align-items:center;font-weight:900;font-size:1.15rem;color:#f5c451}
    .checkout{margin-top:10px;display:flex;gap:8px;align-items:center}
    .small{font-size:.86rem;color:var(--muted)}

    /* toast */
    .toast {
      position: fixed;
      right: 22px;
      bottom: 100px;
      background: rgba(0,0,0,0.9);
      color: #fff;
      padding: 10px 14px;
      border-radius: 10px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
      transform: translateY(10px);
      opacity: 0;
      transition: opacity .28s, transform .28s;
      z-index: 10000;
      pointer-events: none;
    }
    .toast.show { opacity: 1; transform: translateY(0); pointer-events: auto; }

    /* admin kept minimal */
    .admin-toggle{position:fixed;right:160px;bottom:18px;z-index:9999}
    .admin-toggle button{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#111;padding:12px 14px;border-radius:999px;border:none;cursor:pointer;font-weight:800}

    @media(max-width:720px){
      .menu-grid{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
      .options-grid{grid-template-columns:repeat(auto-fit,minmax(120px,1fr))}
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>TROIA <span>D√ñNER</span></h1>
      <p>Tarihten gelen lezzet ¬∑ √áanakkale</p>
    </header>

    <section class="hero">
      <div class="hero-text">
        <h2>Sƒ±cak, taze, sosu tam kararƒ±nda d√∂ner.</h2>
        <p>Aynƒ± anda hem sokak lezzeti, hem sessiz l√ºks. Troia D√∂ner ≈üimdi √ßevrim i√ßi sipari≈üle cebinde.</p>

        <div class="hero-tags">
          <span class="tag">üî• G√ºnl√ºk taze √ºr√ºn</span>
          <span class="tag">üöö Paket servis</span>
          <span class="tag">üìç √áanakkale merkez</span>
        </div>

        <a class="btn-main" id="whatsappCheckout" href="https://wa.me/905415788507?text=Merhaba%2C%20Troia%20D%C3%B6ner%20i%C3%A7in%20sipari%C5%9F%20vermek%20istiyorum." target="_blank" rel="noopener">
          WhatsApp‚Äôtan Sipari≈ü Ver
          <small>Sepetini yaz, hemen hazƒ±rlayalƒ±m.</small>
        </a>
      </div>

      <div class="hero-img" style="flex:0 0 280px;">
        <div style="border-radius:12px;padding:14px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.04)">
          <h3 style="margin-bottom:6px">Bug√ºn√ºn √∂nerisi</h3>
          <p id="hero-suggestion" style="color:#ddd;font-size:.95rem">Pilav√ºst√º tavuk d√∂ner + ayran ¬∑ sosu bol, soƒüan isteƒüe baƒülƒ±.</p>
        </div>
      </div>
    </section>

    <section class="menu">
      <h2>Men√º</h2>
      <div class="menu-grid" id="menuGrid"></div>
    </section>

    <section class="info" style="margin-top:20px;display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
      <div style="background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)">
        <h3 style="color:var(--accent);margin-bottom:6px">√áalƒ±≈üma Saatleri</h3>
        <p class="small">Her g√ºn: 11.00 ‚Äì 23.00<br/>Yoƒüun saat: 12.00 ‚Äì 14.00 / 18.00 ‚Äì 21.00</p>
      </div>
      <div style="background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)">
        <h3 style="color:var(--accent);margin-bottom:6px">Konum</h3>
        <p class="small">Troia D√∂ner ¬∑ √áanakkale Merkez<br/><a href="https://maps.google.com/?q=Troia%20D%C3%B6ner%20%C3%87anakkale" target="_blank" rel="noopener">Haritayƒ± a√ß</a></p>
      </div>
      <div style="background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)">
        <h3 style="color:var(--accent);margin-bottom:6px">Telefon</h3>
        <p class="small"><a href="tel:+905415788507">0 (541) 578 85 07</a><br/>Arayarak da sipari≈ü verebilirsiniz.</p>
      </div>
    </section>

    <section class="steps" style="margin-top:18px">
      <h2>√ú√ß adƒ±mda √ßevrim i√ßi sipari≈ü</h2>
      <div style="display:grid;gap:8px;margin-top:10px">
        <div style="background:var(--card);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)"><strong>1</strong> Men√ºy√º incele ve porsiyon/ekstra se√ßimini yap.</div>
        <div style="background:var(--card);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)"><strong>2</strong> Sepete ekle, sepeti kontrol et, WhatsApp ile g√∂nder.</div>
        <div style="background:var(--card);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)"><strong>3</strong> Onay mesajƒ±nƒ± bekle; teslimat veya gel-al se√ß.</div>
      </div>
    </section>

    <footer style="margin-top:18px;text-align:center;color:var(--muted);font-size:.9rem">Troia D√∂ner ¬∑ Tarihten gelen lezzet</footer>
  </div>

  <!-- toast -->
  <div id="toast" class="toast" aria-hidden="true">Sepete eklendi</div>

  <!-- cart -->
  <div class="cart-toggle"><button id="cartToggle">Sepetim (<span id="cartCount">0</span>)</button></div>

  <div class="cart-panel" id="cartPanel" aria-hidden="true">
    <h3>Sepetiniz</h3>
    <div id="cartList"></div>

    <div class="cart-total">
      <div>Toplam</div><div id="cartTotal">‚Ç∫ 0,00</div>
    </div>

    <!-- M√ú≈ûTERƒ∞ FORMU -->
    <div style="margin-top:10px" class="small">
      <div style="display:grid;gap:6px;margin-top:6px">
        <input id="custName" placeholder="Ad Soyad" />
        <input id="custPhone" placeholder="Telefon (05xx...)" />
        <textarea id="custAddress" placeholder="Adres"></textarea>
        <textarea id="custNote" placeholder="Not (isteƒüe baƒülƒ±)"></textarea>

        <!-- OTP DEMO BLOƒûU -->
        <div style="display:grid;gap:6px;margin-top:6px">
          <button type="button" class="btn-action" onclick="requestOtp()">Doƒürulama Kodu G√∂nder</button>
          <input id="otpCode" placeholder="SMS ile gelen kod" />
          <button type="button" class="btn-action" onclick="verifyOtp()">Kodu Doƒürula</button>
          <span id="otpStatus" class="small"></span>
        </div>
      </div>
    </div>

    <div class="checkout">
      <button id="clearCartBtn" class="btn-action">Temizle</button>
      <a id="checkoutBtn" class="btn-main" href="#" target="_blank" rel="noopener">
        WhatsApp ile G√∂nder
      </a>
    </div>

    <div class="small" style="margin-top:8px">
      Sipari≈üi g√∂ndermeden √∂nce l√ºtfen ad, telefon ve adres bilgilerini doldurun.
    </div>
  </div>

  <!-- ADMIN PANEL -->
  <div class="admin-toggle"><button id="adminToggle">Men√ºy√º D√ºzenle</button></div>
  <div class="admin-panel" id="adminPanel" style="display:none;position:fixed;right:18px;bottom:72px;width:min(720px,96%);max-height:80vh;overflow:auto;background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);">
    <h3 style="color:var(--accent)">Men√º D√ºzenleyici</h3>
    <div class="small">Admin: √ºr√ºn ekle/d√ºzenle, JSON dƒ±≈üa/i√ße aktarma. Deƒüi≈üiklikler tarayƒ±cƒ±da localStorage'a kaydedilir.</div>
    <div style="margin-top:8px">
      <strong>Mevcut √ºr√ºnler</strong>
      <div class="menu-edit-list" id="menuEditList"></div>
    </div>
    <div style="margin-top:10px">
      <strong>Yeni √ºr√ºn ekle</strong>
      <div style="display:grid;gap:8px;margin-top:8px">
        <input id="newName" placeholder="√úr√ºn adƒ±" />
        <input id="newPrice" placeholder="Fiyat (√∂r: 120)" />
        <textarea id="newDesc" placeholder="A√ßƒ±klama"></textarea>
        <div style="display:flex;gap:8px">
          <button id="addItemBtn" class="btn-action">Ekle</button>
          <button id="clearNewBtn" class="btn-action">Temizle</button>
        </div>
      </div>
    </div>
    <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
      <button id="saveAllBtn" class="btn-action">T√ºm√ºn√º Kaydet</button>
      <button id="exportBtn" class="btn-action">JSON Dƒ±≈üa Aktar</button>
      <button id="importBtn" class="btn-action">JSON ƒ∞√ße Aktar</button>
      <button id="resetBtn" class="btn-action" style="border-color:rgba(255,80,80,0.3);color:#ffb3b3">Varsayƒ±lanlara Sƒ±fƒ±rla</button>
      <button id="closeAdminBtn" class="btn-action" style="margin-left:auto">Kapat</button>
    </div>
    <div style="margin-top:8px">
      <textarea id="importArea" placeholder='[{"name":"...","priceDisplay":"‚Ç∫ 45","priceNum":45,"desc":"...","options":[...]}]' style="width:100%;min-height:80px;margin-top:6px"></textarea>
    </div>
  </div>

  <script>
  (function(){
    const STORAGE_KEY = 'troia_menu_v1';
    const CART_KEY = 'troia_cart_v1';

    const defaultMenu = [
      { id: 'm1', name: "Pilav√ºst√º Tavuk D√∂ner", priceDisplay: "‚Ç∫ 250", priceNum: 250, desc: "Tane tane pirin√ß pilav √ºzerinde ince dilim tavuk d√∂ner, patates, domates ve soƒüan e≈üliƒüinde.", note: "Soƒüan / sos tercihini sipari≈ü mesajƒ±nda yazabilirsiniz." },
      { id: 'm2', name: "Yarƒ±m Ekmek (Tavuk)", priceDisplay: "‚Ç∫ 80", priceNum: 80, desc: "ƒ∞nce dilim tavuk d√∂ner.", note: "ƒ∞steƒüe baƒülƒ± ye≈üillik, tur≈üu, patates, ket√ßap, mayonez." },
      { id: 'm3', name: "Sƒ±nƒ±rsƒ±z Porsiyon (Tavuk)", priceDisplay: "‚Ç∫ 350", priceNum: 350, desc: "ƒ∞nce dilim tavuk d√∂ner, mevsim salata, pilav, patates ile servis edilen porsiyon tavuk d√∂ner.", note: "Yalnƒ±zca mekanda ge√ßerlidir. Ki≈üiye √∂zeldir. Ortak sunum yapƒ±lmamaktadƒ±r." },
      { id: 'm4', name: "Tam Ekmek (Tavuk)", priceDisplay: "‚Ç∫ 160", priceNum: 160, desc: "√ñzel lava≈üta tavuk d√∂ner.", note: "" },
      { id: 'm5', name: "Lava≈ü D√ºr√ºm (Tavuk)", priceDisplay: "‚Ç∫ 120", priceNum: 120, desc: "√ñzel lava≈üta ince dilim tavuk d√∂ner, tur≈üu, patates, ket√ßap, mayonez.", note: "", options:[
          { groupName: "Yan Se√ßenekler", type: "multi", choices: [ { id:'p1', name:'Patates', price:30 }, { id:'s1', name:'Mevsim Salata', price:25 } ] }
        ]
      },
      { id: 'm6', name: "Karƒ±≈üƒ±k Tost (Tam)", priceDisplay: "‚Ç∫ 160", priceNum: 160, desc:"Ka≈üar ve sucuklu.", note:"" },

      { id: 'd1', name: "Ayran 330 ml", priceDisplay: "‚Ç∫ 35", priceNum: 35, desc:"Cam ≈üi≈üe ayran.", note:"" },
      { id: 'd2', name: "Kola 330 ml", priceDisplay: "‚Ç∫ 50", priceNum: 50, desc:"Soƒüuk kola.", note:"" },

      { id: 'm10', name: "Men√º: Pilav√ºst√º Tavuk + Ayran", priceDisplay: "‚Ç∫ 280", priceNum: 280, desc:"Pilav√ºst√º tavuk + ayran.", options:[
          { groupName: "Men√ºye ekle", type: "multi", choices:[{id:'mp1',name:'Patates',price:30}] },
          { groupName: "ƒ∞√ßecek se√ß", type: "single", choices:[{id:'md1',name:'Ayran (dahil)',price:0},{id:'md2',name:'Kola (+‚Ç∫15)',price:15}] }
        ]
      }
    ];

    function loadMenu(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return defaultMenu.slice();
        const p = JSON.parse(raw);
        return Array.isArray(p) ? p : defaultMenu.slice();
      }catch(e){
        console.error(e);
        return defaultMenu.slice();
      }
    }

    function loadCart(){
      try{
        const raw = localStorage.getItem(CART_KEY);
        if(!raw) return [];
        const p = JSON.parse(raw);
        return Array.isArray(p) ? p : [];
      }catch(e){ return []; }
    }

    let menuData = loadMenu();
    let cart = loadCart();

    function formatCurrency(n){ return '‚Ç∫ ' + Number(n).toFixed(2).replace('.',','); }
    function parsePriceFromString(str){
      const m = String(str).replace(',','.').match(/(\d+(\.\d+)?)/);
      return m ? parseFloat(m[0]) : 0;
    }
    function escapeHtml(s){
      if(!s && s!==0) return '';
      return String(s)
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#39;');
    }

    // MENU RENDER
    function renderMenu(){
      const grid = document.getElementById('menuGrid');
      grid.innerHTML = '';
      menuData.forEach((it)=>{
        const hasOptions = Array.isArray(it.options) && it.options.length>0;
        const el = document.createElement('div');
        el.className = 'item';
        el.dataset.menuId = it.id;
        el.innerHTML = `
          <div class="item-header">
            <div class="item-name">${escapeHtml(it.name)}</div>
            <div class="item-price">${escapeHtml(it.priceDisplay || '')}</div>
          </div>
          <div class="item-desc">${escapeHtml(it.desc || '')}</div>
          <div class="item-note">${escapeHtml(it.note || '')}</div>
          <div class="item-actions">
            <input class="qty-input" type="number" min="1" value="1" />
            <button class="btn-action btn-add">Sepete Ekle</button>
            ${ hasOptions ? '<button class="btn-toggle-opts">Se√ßenekler</button>' : '' }
          </div>
          <div class="item-opts" aria-hidden="true"></div>
        `;
        grid.appendChild(el);

        if(hasOptions){
          const opts = el.querySelector('.item-opts');
          opts.style.display = 'none';
          it.options.forEach((group,gidx)=>{
            const g = document.createElement('div');
            g.className = 'option-group';
            g.innerHTML = <h4>${escapeHtml(group.groupName)}</h4><div class="options-grid"></div>;
            const gridEl = g.querySelector('.options-grid');
            group.choices.forEach(choice=>{
              const ch = document.createElement('label');
              ch.className = 'option-choice';
              ch.innerHTML = `
                <input type="${group.type==='single'?'radio':'checkbox'}"
                  name="opt-${it.id}-${gidx}"
                  value="${choice.id}"
                  data-opt-name="${escapeHtml(choice.name)}"
                  data-opt-price="${Number(choice.price||0)}" />
                <span class="option-label">${escapeHtml(choice.name)}${choice.price?(' ‚Äî '+formatCurrency(choice.price)) : ''}</span>`;
              gridEl.appendChild(ch);
            });
            opts.appendChild(g);
          });
        }
      });
    }

    // FALLBACK (gerekirse)
    window._addToCartFallback = function(buttonElement){
      try{
        const btn = buttonElement instanceof Element ? buttonElement : (buttonElement.closest ? buttonElement.closest('.item').querySelector('.btn-add') : null);
        if(!btn) return;
        const itemEl = btn.closest('.item');
        if(!itemEl) return;
        const menuId = itemEl.dataset.menuId;
        const item = menuData.find(x=>x.id===menuId);
        if(!item) return;
        const qtyInput = itemEl.querySelector('.qty-input');
        let qty = Number(qtyInput?.value) || 1;
        if(qty < 1) qty = 1;
        const mods = [];
        const optsArea = itemEl.querySelector('.item-opts');
        if(optsArea){
          optsArea.querySelectorAll('input').forEach(inp=>{
            if((inp.type==='checkbox' && inp.checked) || (inp.type==='radio' && inp.checked)){
              mods.push({ id: inp.value, name: inp.dataset.optName, price: Number(inp.dataset.optPrice)||0 });
            }
          });
        }
        addToCart(item, qty, mods);
      }catch(e){
        console.error('fallback add error', e);
      }
    };

    // MENU EVENT DELEGATION
    document.getElementById('menuGrid').addEventListener('click', function(e){
      const btn = e.target.closest('button');
      if(!btn) return;
      const itemEl = btn.closest('.item');
      if(!itemEl) return;
      const menuId = itemEl.dataset.menuId;
      const item = menuData.find(x=>x.id===menuId);
      if(!item) return;

      if(btn.classList.contains('btn-toggle-opts')){
        const opts = itemEl.querySelector('.item-opts');
        const isHidden = opts.style.display === 'none' || opts.style.display === '';
        opts.style.display = isHidden ? 'grid' : 'none';
        opts.setAttribute('aria-hidden', isHidden ? 'false' : 'true');
        return;
      }

      if(btn.classList.contains('btn-add')){
        const qtyInput = itemEl.querySelector('.qty-input');
        let qty = Number(qtyInput?.value) || 1;
        if(qty < 1) qty = 1;
        const mods = [];
        const optsArea = itemEl.querySelector('.item-opts');
        if(optsArea){
          optsArea.querySelectorAll('input').forEach(inp=>{
            if((inp.type==='checkbox' && inp.checked) || (inp.type==='radio' && inp.checked)){
              mods.push({ id: inp.value, name: inp.dataset.optName, price: Number(inp.dataset.optPrice)||0 });
            }
          });
        }
        addToCart(item, qty, mods);
      }
    });

    // CART FUNCTIONS
    function addToCart(item, qty, mods){
      const base = Number(item.priceNum || parsePriceFromString(item.priceDisplay || '0')) || 0;
      const cartItem = {
        cartId: 'c_'+Date.now()+'_'+Math.random().toString(36).slice(2,6),
        id:item.id, name:item.name, basePrice:base, qty:qty, mods:mods||[]
      };
      cart.push(cartItem);
      persistCart();
      renderCart();
      showToast('Sepete eklendi');
    }

    function persistCart(){
      try{ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }catch(e){}
    }

    function renderCart(){
      const list = document.getElementById('cartList'); list.innerHTML = '';
      let total = 0;
      cart.forEach((ci,idx)=>{
        const modsTotal = (ci.mods || []).reduce((s,m) => s + Number(m.price||0), 0);
        const itemTotal = (ci.basePrice + modsTotal) * ci.qty;
        total += itemTotal;
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <div>
            <div class="cart-item-name">${escapeHtml(ci.name)}</div>
            <div style="color:#bdbdbf">${ci.qty} x ${formatCurrency(ci.basePrice)}</div>
            ${ci.mods && ci.mods.length ? '<div style="color:#ccc;margin-top:6px;font-size:.92rem">'+ci.mods.map(m=>escapeHtml(m.name)).join(', ')+'</div>' : ''}
          </div>
          <div class="cart-controls">
            <div style="font-weight:800;color:#f5c451">${formatCurrency(itemTotal)}</div>
            <button data-action="minus" data-idx="${idx}">-</button>
            <button data-action="plus" data-idx="${idx}">+</button>
            <button data-action="remove" data-idx="${idx}">‚úï</button>
          </div>`;
        list.appendChild(div);
      });
      document.getElementById('cartTotal').textContent = formatCurrency(total);
      document.getElementById('cartCount').textContent = cart.length;

      const cartList = document.getElementById('cartList');
      cartList.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const act = btn.dataset.action;
          const idx = Number(btn.dataset.idx);
          if(act==='remove'){ cart.splice(idx,1); }
          else if(act==='minus'){ cart[idx].qty = Math.max(1, cart[idx].qty - 1); }
          else if(act==='plus'){ cart[idx].qty = cart[idx].qty + 1; }
          persistCart(); renderCart();
        });
      });

      updateCheckoutLink();
    }

    // M√ú≈ûTERƒ∞ Bƒ∞LGƒ∞LERƒ∞ DAHƒ∞L WHATSAPP METNƒ∞
    function updateCheckoutLink(){
      const checkoutBtn = document.getElementById('checkoutBtn');
      const name  = (document.getElementById('custName')   || {}).value?.trim()  || '';
      const phone = (document.getElementById('custPhone')  || {}).value?.trim() || '';
      const addr  = (document.getElementById('custAddress')|| {}).value?.trim() || '';
      const note  = (document.getElementById('custNote')   || {}).value?.trim() || '';

      if(cart.length===0){
        checkoutBtn.href = 'https://wa.me/905415788507?text=Merhaba,%20Troia%20D√∂ner%27den%20sipari≈ü%20vermek%20istiyorum.';
        return;
      }

      let text = 'Merhaba,%20Troia%20D√∂ner%27den%20sipari≈ü%20vermek%20istiyorum.%0A%0A';
      text += 'Sipari≈ü%20Detaylarƒ±:%0A';

      cart.forEach((ci,i)=>{
        const modsText = ci.mods && ci.mods.length ? ' (' + ci.mods.map(m=>m.name).join(', ') + ')' : '';
        text += ${i+1}.%20${encodeURIComponent(ci.name)}%20x${ci.qty}%20${encodeURIComponent(modsText)}%0A;
      });

      const total = cart.reduce((s,ci)=>
        s + (ci.basePrice + (ci.mods||[]).reduce((ss,m)=>ss + Number(m.price||0),0))*ci.qty,
      0);

      text += %0AToplam:%20${encodeURIComponent(formatCurrency(total))}%0A%0A;

      if(name)  text += Ad:%20${encodeURIComponent(name)}%0A;
      if(phone) text += Telefon:%20${encodeURIComponent(phone)}%0A;
      if(addr)  text += Adres:%20${encodeURIComponent(addr)}%0A;
      if(note)  text += %0ANot:%20${encodeURIComponent(note)}%0A;

      checkoutBtn.href = https://wa.me/905415788507?text=${text};
    }

    // CART TOGGLE
    document.getElementById('cartToggle').addEventListener('click', ()=>{
      const p = document.getElementById('cartPanel');
      const isHidden = p.style.display === 'none' || p.style.display === '';
      p.style.display = isHidden ? 'block' : 'none';
      p.setAttribute('aria-hidden', isHidden ? 'false' : 'true');
      renderCart();
    });

    document.getElementById('clearCartBtn').addEventListener('click', ()=>{
      if(confirm('Sepeti temizlemek istiyor musunuz?')){
        cart = []; persistCart(); renderCart();
      }
    });

    // TOAST
    function showToast(msg, ms = 1100){
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.add('show');
      t.setAttribute('aria-hidden', 'false');
      clearTimeout(t._hide);
      t._hide = setTimeout(()=>{
        t.classList.remove('show');
        t.setAttribute('aria-hidden','true');
      }, ms);
    }

    // ADMIN LIST
    function renderAdminList(){
      const list = document.getElementById('menuEditList'); if(!list) return;
      list.innerHTML = '';
      menuData.forEach((it,idx)=>{
        const row = document.createElement('div'); row.className='menu-edit-item';
        row.style.marginTop = '8px';
        row.style.padding = '8px';
        row.style.borderRadius = '8px';
        row.style.border = '1px solid rgba(255,255,255,0.05)';
        row.innerHTML = `
          <div>
            <input data-idx="${idx}" data-field="name" value="${escapeHtml(it.name)}" style="width:100%;margin-bottom:6px"/>
            <input data-idx="${idx}" data-field="priceNum" value="${escapeHtml(it.priceNum||'')}" placeholder="numeric price" style="width:100%;margin-bottom:6px"/>
            <textarea data-idx="${idx}" data-field="desc" style="width:100%;min-height:60px">${escapeHtml(it.desc||'')}</textarea>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px">
            <div class="menu-edit-actions">
              <button data-action="move-up" data-idx="${idx}">‚ñ≤</button>
              <button data-action="move-down" data-idx="${idx}">‚ñº</button>
            </div>
            <div style="display:flex;flex-direction:column;gap:4px;align-items:flex-end">
              <button data-action="delete" data-idx="${idx}" style="color:#ffb3b3">Sil</button>
              <span class="small">#${idx+1}</span>
            </div>
          </div>`;
        list.appendChild(row);
      });
    }

    function bindAdminEvents(){
      const list = document.getElementById('menuEditList'); if(!list) return;
      list.addEventListener('input',(e)=>{
        const t = e.target;
        const idx = Number(t.getAttribute('data-idx'));
        const field = t.getAttribute('data-field');
        if(!isNaN(idx) && field && menuData[idx]){
          if(field==='priceNum'){
            const v = t.value.trim();
            menuData[idx][field] = v===''?undefined:Number(v);
            menuData[idx].priceDisplay = v ? '‚Ç∫ '+v : '‚Ç∫ ‚Äî';
          } else {
            menuData[idx][field] = t.value;
          }
          renderMenu();
        }
      });
      list.addEventListener('click',(e)=>{
        const btn = e.target.closest('button'); if(!btn) return;
        const action = btn.getAttribute('data-action');
        const idx = Number(btn.getAttribute('data-idx'));
        if(action==='delete'){
          if(confirm('Silinsin mi?')){
            menuData.splice(idx,1); renderAdminList(); renderMenu();
          }
        }else if(action==='move-up' && idx>0){
          [menuData[idx-1],menuData[idx]]=[menuData[idx],menuData[idx-1]];
          renderAdminList(); renderMenu();
        }else if(action==='move-down' && idx<menuData.length-1){
          [menu
